(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{378:function(a,s,t){"use strict";t.r(s);var e=t(8),n=Object(e.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"lab-2-installing-istio"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#lab-2-installing-istio"}},[a._v("#")]),a._v(" Lab 2 - Installing Istio")]),a._v(" "),t("p",[a._v("In the second laboratory of the workshop, we will install and configure Istio as in its "),t("a",{attrs:{href:"https://istio.io/latest/docs/setup/getting-started/",target:"_blank",rel:"noopener noreferrer"}},[a._v("getting-started"),t("OutboundLink")],1),a._v(" tutorial.")]),a._v(" "),t("p",[a._v("We will perform the following task:")]),a._v(" "),t("ol",[t("li",[a._v("Download Istio in your laptop.")]),a._v(" "),t("li",[a._v("Install in your Minikube cluster.")]),a._v(" "),t("li",[a._v("Deploy a sample application.")]),a._v(" "),t("li",[a._v("Use a dashboard for Istio.")])]),a._v(" "),t("h2",{attrs:{id:"_1-downloading-istio"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-downloading-istio"}},[a._v("#")]),a._v(" 1. Downloading Istio")]),a._v(" "),t("ol",[t("li",[t("p",[a._v("Execute Istio downloader:")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" -L https://istio.io/downloadIstio "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("ISTIO_VERSION")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1.8")]),a._v(".1 "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sh")]),a._v(" -\n")])])])]),a._v(" "),t("li",[t("p",[a._v("Move to the Istio package directory:")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" istio-1.8.1\n")])])])]),a._v(" "),t("li",[t("p",[a._v("Add the "),t("code",[a._v("istioctl")]),a._v(" client to your path (Linux or macOS):")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("PATH")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("$PWD")]),a._v("/bin:"),t("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("$PATH")]),a._v("\n")])])])])]),a._v(" "),t("h2",{attrs:{id:"_2-installing-istio-in-minikube"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-installing-istio-in-minikube"}},[a._v("#")]),a._v(" 2. Installing Istio in Minikube")]),a._v(" "),t("ol",[t("li",[t("p",[a._v("For this installation, we use the "),t("code",[a._v("demo")]),a._v(" "),t("a",{attrs:{href:"https://istio.io/latestdocs/setup/additional-setup/config-profiles/",target:"_blank",rel:"noopener noreferrer"}},[a._v("configuration profile"),t("OutboundLink")],1),a._v(".")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[a._v("istioctl "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" --set "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("profile")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("demo\n")])])])]),a._v(" "),t("li",[t("p",[a._v("(Optional) Add a namespace label to instruct Istio to automatically inject Envoy sidecar proxies when you deploy your application later:")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[a._v("kubectl label namespace default istio-injection"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("enabled\n")])])])])]),a._v(" "),t("h2",{attrs:{id:"_3-deploying-a-sample-application"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-deploying-a-sample-application"}},[a._v("#")]),a._v(" 3. Deploying a sample application")]),a._v(" "),t("ol",[t("li",[t("p",[a._v("Deploy the "),t("a",{attrs:{href:"https://istio.io/latest/docs/examples/bookinfo/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Bookinfo sample application"),t("OutboundLink")],1),a._v(":")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[a._v("kubectl apply -f samples/bookinfo/platform/kube/bookinfo.yaml\n")])])])]),a._v(" "),t("li",[t("p",[a._v("The application will start. As each pod becomes ready, the Istio sidecar will deploy along with it.")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[a._v("kubectl get services\n")])])]),t("p",[a._v("and")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[a._v("kubectl get pods\n")])])])]),a._v(" "),t("li",[t("p",[a._v("Verify everything is working correctly up to this point. Run this command to see if the app is running inside the cluster and serving HTML pages by     checking for the page title in the response:")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[a._v("kubectl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),a._v("kubectl get pod -l "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("app")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("ratings -o "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("jsonpath")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'{.items[0].metadata.name}'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v('"')]),a._v(" -c ratings -- "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" -s productpage:9080/productpage "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" -o "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"<title>.*</title>"')]),a._v("\n")])])])])]),a._v(" "),t("h3",{attrs:{id:"_3-1-opening-sample-application-to-outside-traffic"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-opening-sample-application-to-outside-traffic"}},[a._v("#")]),a._v(" 3.1 Opening sample application to outside traffic")]),a._v(" "),t("p",[a._v("The Bookinfo application is deployed but not accessible from the outside. To make it accessible, you need to create an "),t("a",{attrs:{href:"https://istio.io/latestdocs/concepts/traffic-management/#gateways",target:"_blank",rel:"noopener noreferrer"}},[a._v("Istio Ingress Gateway"),t("OutboundLink")],1),a._v(", which maps a path to a route at the edge of your mesh.")]),a._v(" "),t("ol",[t("li",[t("p",[a._v("Associate this application with the Istio gateway:")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[a._v("kubectl apply -f samples/bookinfo/networking/bookinfo-gateway.yaml\n")])])])]),a._v(" "),t("li",[t("p",[a._v("Ensure that there are no issues with the configuration:")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[a._v("istioctl analyze\n")])])])])]),a._v(" "),t("h3",{attrs:{id:"_3-2-determining-the-ingress-ip-and-ports"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-determining-the-ingress-ip-and-ports"}},[a._v("#")]),a._v(" 3.2 Determining the ingress IP and ports")]),a._v(" "),t("p",[a._v("Follow these instructions to set the "),t("code",[a._v("INGRESS_HOST")]),a._v(" and "),t("code",[a._v("INGRESS_PORT")]),a._v(" variables for accessing the gateway. Use the tabs to choose the instructions for your chosen platform:")]),a._v(" "),t("ol",[t("li",[t("p",[a._v("Set the ingress ports:")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("INGRESS_PORT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),a._v("kubectl -n istio-system get "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("service")]),a._v(" istio-ingressgateway -o "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("jsonpath")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'{.spec.ports[?(.name==\"http2\")].nodePort}'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("SECURE_INGRESS_PORT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),a._v("kubectl -n istio-system get "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("service")]),a._v(" istio-ingressgateway -o "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("jsonpath")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'{.spec.ports[?(.name==\"https\")].nodePort}'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("\n")])])])]),a._v(" "),t("li",[t("p",[a._v("Ensure a port was successfully assigned to each environment variable:")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$INGRESS_PORT")]),a._v('"')]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$SECURE_INGRESS_PORT")]),a._v('"')]),a._v("\n")])])])]),a._v(" "),t("li",[t("p",[a._v("Set the ingress IP:")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("INGRESS_HOST")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),a._v("minikube "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ip")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("\n")])])])]),a._v(" "),t("li",[t("p",[a._v("Ensure an IP address was successfully assigned to the environment variable:")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$INGRESS_HOST")]),a._v('"')]),a._v("\n")])])])]),a._v(" "),t("li",[t("p",[a._v("Run this command in a "),t("strong",[a._v("new terminal window")]),a._v(" to start a Minikube tunnel that sends traffic to your Istio Ingress Gateway:")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[a._v("minikube tunnel\n")])])])]),a._v(" "),t("li",[t("p",[a._v("Set "),t("code",[a._v("GATEWAY_URL")]),a._v(":")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("GATEWAY_URL")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$INGRESS_HOST")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$INGRESS_PORT")]),a._v("\n")])])])]),a._v(" "),t("li",[t("p",[a._v("Run the following command to retrieve the external address of the Bookinfo application.")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" http://"),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$GATEWAY_URL")]),a._v('/productpage"')]),a._v("\n")])])])]),a._v(" "),t("li",[t("p",[a._v("Paste the output from the previous command into your web browser and confirm that the Bookinfo product page is displayed.")])])]),a._v(" "),t("h2",{attrs:{id:"_4-managing-istio-using-a-dashboard"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-managing-istio-using-a-dashboard"}},[a._v("#")]),a._v(" 4. Managing Istio using a dashboard")]),a._v(" "),t("p",[a._v("Istio has several optional dashboards installed by the demo installation. The "),t("a",{attrs:{href:"https://kiali.io/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Kiali"),t("OutboundLink")],1),a._v(" dashboard helps you understand the structure of your service mesh by displaying the topology and indicates the health of your mesh.")]),a._v(" "),t("ol",[t("li",[t("p",[a._v("Install "),t("code",[a._v("Kiali")]),a._v(" and the other addons and wait for them to be deployed.")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[a._v("kubectl apply -f samples/addons\nkubectl rollout status deployment/kiali -n istio-system\n")])])])]),a._v(" "),t("li",[t("p",[a._v("Access the Kiali dashboard. The default user name is "),t("code",[a._v("admin")]),a._v(" and default password is "),t("code",[a._v("admin")]),a._v(".")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[a._v("istioctl dashboard kiali\n")])])])]),a._v(" "),t("li",[t("p",[a._v("In the left navigation menu, select "),t("em",[a._v("Graph")]),a._v(" and in the "),t("em",[a._v("Namespace")]),a._v(" drop down, select "),t("em",[a._v("default")]),a._v(".")]),a._v(" "),t("p",[a._v("The Kiali dashboard shows an overview of your mesh with the relationships between the services in the "),t("code",[a._v("Bookinfo")]),a._v(" sample application. It also provides filters to visualize the traffic flow.")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://istio.io/latest/docs/setup/getting-started/kiali-example2.png",alt:"Kiali Dashboard"}})])])])])}),[],!1,null,null,null);s.default=n.exports}}]);